//
//  MarketDataModel.swift
//  SwiftfulCrypto
//
//  Created by Artur Remizov on 31.10.22.
//

import Foundation

// JSON data:
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 13255,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 605,
     "total_market_cap": {
       "btc": 51678181.22318161,
       "eth": 662103583.1707937,
       "ltc": 19163552622.89431,
       "bch": 9158778255.163357,
       "bnb": 3214388487.399632,
       "eos": 947164479607.3412,
       "xrp": 2330292687453.2383,
       "xlm": 9538026234243.605,
       "link": 131025075627.36009,
       "dot": 158006465013.0368,
       "yfi": 129584755.00949773,
       "usd": 1066615876263.0552,
       "aed": 3917690779672.9604,
       "ars": 167353118933867.1,
       "aud": 1673255789119.4175,
       "bdt": 108110219444963.34,
       "bhd": 402146183827.45953,
       "bmd": 1066615876263.0552,
       "brl": 5656263991822.974,
       "cad": 1456780763952.4521,
       "chf": 1069133089731.0345,
       "clp": 1006362745412954,
       "cny": 7787362512596.567,
       "czk": 26395048180115.207,
       "dkk": 8026155408358.4375,
       "eur": 1078230256539.6836,
       "gbp": 928522185379.1509,
       "hkd": 8372628509908.471,
       "huf": 441692034055788.25,
       "idr": 16672143854939468,
       "ils": 3763092274719.7637,
       "inr": 88338679864821.94,
       "jpy": 158690770694577.5,
       "krw": 1523634163975812.2,
       "kwd": 330416266148.76917,
       "lkr": 390071724125684.25,
       "mmk": 2241127905364554,
       "mxn": 21221411873063.117,
       "myr": 5042959862971.722,
       "ngn": 470361970176340.25,
       "nok": 11100132764205.705,
       "nzd": 1843216762538.4333,
       "php": 62112242322426.336,
       "pkr": 235457197535411.12,
       "pln": 5075955625103.917,
       "rub": 65756869838233.3,
       "sar": 4008483256292.226,
       "sek": 11767361791913.18,
       "sgd": 1511098177451.146,
       "thb": 40621532339540.29,
       "try": 19854734551873.88,
       "twd": 34433025958846.168,
       "uah": 39412365384646.445,
       "vef": 106800247690.21939,
       "vnd": 26503069311535730,
       "zar": 19591350827084.715,
       "xdr": 794757888337.0051,
       "xag": 55996213557.140205,
       "xau": 651680968.0792027,
       "bits": 51678181223181.61,
       "sats": 5167818122318161
     },
     "total_volume": {
       "btc": 3609128.0913920826,
       "eth": 46240339.44060592,
       "ltc": 1338354300.8888454,
       "bch": 639635588.9690881,
       "bnb": 224488159.45011085,
       "eos": 66148572755.61757,
       "xrp": 162744210426.66956,
       "xlm": 666121709465.2987,
       "link": 9150598374.993734,
       "dot": 11034938885.277636,
       "yfi": 9050008.503610909,
       "usd": 74490882431.03563,
       "aed": 273605756078.01788,
       "ars": 11687695434129.564,
       "aud": 116857720795.4518,
       "bdt": 7550258556513.452,
       "bhd": 28085297402.973347,
       "bmd": 74490882431.03563,
       "brl": 395025149531.7813,
       "cad": 101739423751.66116,
       "chf": 74666680913.57277,
       "clp": 70282892482506.336,
       "cny": 543857932628.99115,
       "czk": 1843391303751.3882,
       "dkk": 560534876896.7672,
       "eur": 75302013649.82716,
       "gbp": 64846622373.57167,
       "hkd": 584732048200.3702,
       "huf": 30847121359986.402,
       "idr": 1164357980609430.2,
       "ils": 262808824105.81622,
       "inr": 6169443341663.18,
       "jpy": 11082729786580.484,
       "krw": 106408366781744.97,
       "kwd": 23075785559.48621,
       "lkr": 27242034914499.57,
       "mmk": 156517073321953.34,
       "mxn": 1482072161156.4136,
       "myr": 352192892133.93616,
       "ngn": 32849387488204.65,
       "nok": 775216929645.072,
       "nzd": 128727544947.3078,
       "php": 4337827556606.487,
       "pkr": 16443984014752.996,
       "pln": 354497267581.9401,
       "rub": 4592362976364.233,
       "sar": 279946568972.3126,
       "sek": 821815222585.9823,
       "sgd": 105532871939.4615,
       "thb": 2836948011944.774,
       "try": 1386625429188.9978,
       "twd": 2404751837589.023,
       "uah": 2752501572058.5957,
       "vef": 7458772057.819574,
       "vnd": 1850935340531437.8,
       "zar": 1368231097626.771,
       "xdr": 55504720807.89578,
       "xag": 3910693112.2028093,
       "xau": 45512439.34771423,
       "bits": 3609128091392.0825,
       "sats": 360912809139208.25
     },
     "market_cap_percentage": {
       "btc": 37.14219625972468,
       "eth": 18.20303917779947,
       "usdt": 6.4650180324429,
       "bnb": 5.079429643272626,
       "usdc": 4.072421887544809,
       "xrp": 2.1493182425831403,
       "busd": 2.001727656079631,
       "doge": 1.5316214113672593,
       "ada": 1.34661098419847,
       "sol": 1.1309830703966601
     },
     "market_cap_change_percentage_24h_usd": 0.3717040813631239,
     "updated_at": 1667224290
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
}
